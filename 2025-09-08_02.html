<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>數學公式查詢</title>
  <style>
    /* 原有的style.css內容 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }
    body {
      background-color: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    #search-input {
      width: 70%;
      height: 40px;
      padding: 10px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #search-btn {
      width: 20%;
      height: 40px;
      padding: 10px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: #fff;
      cursor: pointer;
    }
    .categories {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
    }
    .category-btn {
      width: 100px;
      height: 40px;
      padding: 10px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: #fff;
      cursor: pointer;
      margin: 10px;
    }
    #formula-container {
      padding: 20px;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }
    .chat-content {
      width: 50%;
    }
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }
    #chat-title {
      font-size: 24px;
      margin: 0;
    }
    .close-btn {
      font-size: 24px;
      cursor: pointer;
    }
    .chat-messages {
      padding: 20px;
    }
    .chat-input-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-top: 1px solid #ccc;
    }
    #chat-input {
      width: 80%;
      height: 40px;
      padding: 10px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    #send-message {
      width: 15%;
      height: 40px;
      padding: 10px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: #fff;
      cursor: pointer;
    }
    .formula-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      background-color: #f9f9f9;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .formula-display {
      padding: 10px;
      margin: 10px 0;
      background-color: #fff;
      border-radius: 5px;
      overflow-x: auto;
    }
    .learn-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .learn-btn:hover {
      background-color: #45a049;
    }
    .user-message, .ai-message {
      max-width: 85%;
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 10px;
      word-wrap: break-word;
    }
    .user-message {
      background-color: #dcf8c6;
      align-self: flex-end;
      margin-left: auto;
    }
    .ai-message {
      background-color: #f0f0f0;
      align-self: flex-start;
      margin-right: auto;
    }
    .loading {
      font-style: italic;
      color: #888;
    }
    .chat-messages {
      display: flex;
      flex-direction: column;
      max-height: 60vh;
      overflow-y: auto;
    }
    .category-btn.active {
      background-color: #367c39;
    }
    /* 新增搜索高亮樣式 */
    .formula-card mark {
      background-color: #ffeb3b;
      padding: 0 3px;
      border-radius: 3px;
    }
  </style>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        packages: {'[+]': ['ams']}
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
    // 預設API金鑰
    const DEFAULT_API_KEY = "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";
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.js"></script>
</head>
<body>
  <div class="container">
    <h1>數學公式查詢</h1>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="輸入關鍵字查詢公式...">
      <button id="search-btn">搜尋</button>
    </div>
    <div class="categories">
      <button class="category-btn" data-category="all">全部</button>
      <button class="category-btn" data-category="algebra">代數</button>
      <button class="category-btn" data-category="geometry">幾何</button>
      <button class="category-btn" data-category="trigonometry">三角函數</button>
      <button class="category-btn" data-category="calculus">微積分</button>
      <button class="category-btn" data-category="statistics">概率統計</button>
      <button class="category-btn" data-category="linear_algebra">線性代數</button>
      <button class="category-btn" data-category="differential_equations">微分方程</button>
      <button class="category-btn" data-category="probability">機率論</button>
      <button class="category-btn" data-category="number_theory">數論</button>
      <button class="category-btn" data-category="exponential">指數</button>
      <button class="category-btn" data-category="logarithm">對數</button>
    </div>
    <div id="formula-container">
      <!-- 公式會在這裡顯示 -->
    </div>
  </div>
  <!-- API 金鑰輸入對話框 -->
  <div id="api-key-modal" class="modal">
    <div class="modal-content">
      <h2>請輸入您的 API 金鑰</h2>
      <p>需要 Groq API 金鑰才能進行互動學習</p>
      <input type="text" id="api-key-input" placeholder="輸入 Groq API 金鑰...">
      <button id="save-api-key">儲存</button>
    </div>
  </div>
  <!-- 聊天對話框 -->
  <div id="chat-modal" class="modal">
    <div class="modal-content chat-content">
      <div class="chat-header">
        <h2 id="chat-title">公式互動學習</h2>
        <button id="download-history-btn" style="margin-right:10px;">下載學習歷程</button>
        <span class="close-btn">&times;</span>
      </div>
      <div id="chat-messages" class="chat-messages">
        <!-- 聊天訊息將在這裡顯示 -->
      </div>
      <div class="chat-input-container">
        <input type="text" id="chat-input" placeholder="輸入訊息...">
        <button id="send-message">發送</button>
      </div>
    </div>
  </div>
  <script type="module">
    // ------------------ 公式資料 ------------------
    const formulas = [
      /*【代數 Algebra】(21)*/
      { id: 1, title: "二次方程根公式", category: "algebra", formula: "$$x = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$$", description: "適用於 $ax^2+bx+c=0$ 的二次方程求根。" },
      { id: 2, title: "平方和公式", category: "algebra", formula: "$$(a+b)^2 = a^2+2ab+b^2$$", description: "兩數和的平方展開式。" },
      { id: 3, title: "平方差公式", category: "algebra", formula: "$$(a-b)^2 = a^2-2ab+b^2$$", description: "兩數差的平方展開式。" },
      { id: 4, title: "完全平方公式", category: "algebra", formula: "$$a^2+2ab+b^2 = (a+b)^2$$", description: "將多項式表達為完全平方的形式。" },
      { id: 5, title: "平方差分解", category: "algebra", formula: "$$a^2-b^2 = (a+b)(a-b)$$", description: "差平方的因式分解公式。" },
      { id: 6, title: "立方和公式", category: "algebra", formula: "$$a^3+b^3=(a+b)(a^2-ab+b^2)$$", description: "兩數立方和的因式分解公式。" },
      { id: 7, title: "立方差公式", category: "algebra", formula: "$$a^3-b^3=(a-b)(a^2+ab+b^2)$$", description: "兩數立方差的因式分解公式。" },
      { id: 8, title: "二項式定理", category: "algebra", formula: "$$(a+b)^n = \\sum_{k=0}^n \\binom{n}{k} a^{n-k}b^k$$", description: "二項式展開公式。" },
      { id: 9, title: "餘式定理", category: "algebra", formula: "$$f(a) = \\text{餘式, 當 } f(x)\\text{ 被 }(x-a)\\text{ 除時}$$", description: "多項式除法的餘式定理。" },
      { id: 10, title: "因式定理", category: "algebra", formula: "$$(x-a) \\text{ 為因式 } \\iff f(a)=0$$", description: "多項式因式分解的依據。" },
      { id: 11, title: "韋達定理", category: "algebra", formula: "$$x_1+x_2=-\\frac{b}{a}, \\quad x_1x_2=\\frac{c}{a}$$", description: "二次方程根與係數的關係。" },
      { id: 12, title: "算術平均數", category: "algebra", formula: "$$\\bar{x}=\\frac{1}{n}\\sum_{i=1}^n x_i$$", description: "數據的算術平均值。" },
      { id: 13, title: "幾何平均數", category: "algebra", formula: "$$G=\\sqrt[n]{x_1x_2\\cdots x_n}$$", description: "正數數據的幾何平均值。" },
      { id: 14, title: "調和平均數", category: "algebra", formula: "$$H=\\frac{n}{\\sum_{i=1}^n \\frac{1}{x_i}}$$", description: "非零數據的調和平均值。" },
      { id: 15, title: "平均數不等式", category: "algebra", formula: "$$H \\leq G \\leq \\bar{x}$$", description: "調和、幾何與算術平均數的不等關係。" },
      { id: 16, title: "二項式係數", category: "algebra", formula: "$$\\binom{n}{k}=\\frac{n!}{k!(n-k)!}$$", description: "組合數學中二項式係數的定義。" },
      { id: 17, title: "等差數列求和", category: "algebra", formula: "$$S_n=\\frac{n(a_1+a_n)}{2}$$", description: "等差數列前 n 項和的公式。" },
      { id: 18, title: "等比數列求和", category: "algebra", formula: "$$S_n=\\frac{a_1(1-r^n)}{1-r}$$", description: "等比數列前 n 項和的公式（$r\\neq1$）。" },
      { id: 19, title: "無窮等比級數", category: "algebra", formula: "$$S=\\frac{a_1}{1-r}\\quad(|r|<1)$$", description: "無窮等比級數和的公式。" },
      { id: 20, title: "部分分式分解", category: "algebra", formula: "$$\\frac{P(x)}{Q(x)}=\\sum \\frac{A_i}{(x-r_i)^{m_i}}$$", description: "有理分式的部分分式展開法。" },
      { id: 21, title: "牛頓二項式", category: "algebra", formula: "$$(x+y)^n=\\sum_{k=0}^n \\binom{n}{k}x^{n-k}y^k$$", description: "二項式展開公式（與 8 相同）。" },
      
      /*【三角函數 Trigonometry】(21)*/
      { id: 22, title: "三角恆等式", category: "trigonometry", formula: "$$\\sin^2\\theta+\\cos^2\\theta=1$$", description: "基本的三角恆等式。" },
      { id: 23, title: "正弦定理", category: "trigonometry", formula: "$$\\frac{a}{\\sin A}=\\frac{b}{\\sin B}=\\frac{c}{\\sin C}$$", description: "任意三角形中邊長與對角正弦的比值相等。" },
      { id: 24, title: "余弦定理", category: "trigonometry", formula: "$$c^2=a^2+b^2-2ab\\cos C$$", description: "三角形中邊長與夾角的關係。" },
      { id: 25, title: "正切定理", category: "trigonometry", formula: "$$\\tan\\theta=\\frac{\\sin\\theta}{\\cos\\theta}$$", description: "正切定義式。" },
      { id: 26, title: "餘切定理", category: "trigonometry", formula: "$$\\cot\\theta=\\frac{\\cos\\theta}{\\sin\\theta}$$", description: "餘切定義式。" },
      { id: 27, title: "正弦雙角公式", category: "trigonometry", formula: "$$\\sin(2\\theta)=2\\sin\\theta\\cos\\theta$$", description: "雙角正弦公式。" },
      { id: 28, title: "余弦雙角公式", category: "trigonometry", formula: "$$\\cos(2\\theta)=\\cos^2\\theta-\\sin^2\\theta$$", description: "雙角余弦公式。" },
      { id: 29, title: "正切雙角公式", category: "trigonometry", formula: "$$\\tan(2\\theta)=\\frac{2\\tan\\theta}{1-\\tan^2\\theta}$$", description: "雙角正切公式。" },
      { id: 30, title: "正弦半角公式", category: "trigonometry", formula: "$$\\sin^2\\frac{\\theta}{2}=\\frac{1-\\cos\\theta}{2}$$", description: "半角正弦公式。" },
      { id: 31, title: "余弦半角公式", category: "trigonometry", formula: "$$\\cos^2\\frac{\\theta}{2}=\\frac{1+\\cos\\theta}{2}$$", description: "半角余弦公式。" },
      { id: 32, title: "正弦和差公式", category: "trigonometry", formula: "$$\\sin(\\alpha\\pm\\beta)=\\sin\\alpha\\cos\\beta\\pm\\cos\\alpha\\sin\\beta$$", description: "正弦和差公式。" },
      { id: 33, title: "余弦和差公式", category: "trigonometry", formula: "$$\\cos(\\alpha\\pm\\beta)=\\cos\\alpha\\cos\\beta\\mp\\sin\\alpha\\sin\\beta$$", description: "余弦和差公式。" },
      { id: 34, title: "餘切和差公式", category: "trigonometry", formula: "$$\\cot(\\alpha\\pm\\beta)=\\frac{\\cot\\alpha\\cot\\beta\\mp1}{\\cot\\beta\\pm\\cot\\alpha}$$", description: "餘切和差公式。" },
      { id: 35, title: "正切和差公式", category: "trigonometry", formula: "$$\\tan(\\alpha\\pm\\beta)=\\frac{\\tan\\alpha\\pm\\tan\\beta}{1\\mp\\tan\\alpha\\tan\\beta}$$", description: "正切和差公式。" },
      { id: 36, title: "三角函數周期性", category: "trigonometry", formula: "$$\\sin(\\theta+2\\pi)=\\sin\\theta,\\quad\\cos(\\theta+2\\pi)=\\cos\\theta$$", description: "正弦與余弦的周期性。" },
      { id: 37, title: "正弦極值", category: "trigonometry", formula: "$$\\max\\sin\\theta=1,\\quad\\min\\sin\\theta=-1$$", description: "正弦函數的最大與最小值。" },
      { id: 38, title: "余弦極值", category: "trigonometry", formula: "$$\\max\\cos\\theta=1,\\quad\\min\\cos\\theta=-1$$", description: "余弦函數的最大與最小值。" },
      { id: 39, title: "反正弦函數", category: "trigonometry", formula: "$$y=\\arcsin x \\iff x=\\sin y,\\;y\\in\\left[-\\frac{\\pi}{2},\\frac{\\pi}{2}\\right]$$", description: "反正弦函數定義。" },
      { id: 40, title: "反余弦函數", category: "trigonometry", formula: "$$y=\\arccos x \\iff x=\\cos y,\\;y\\in[0,\\pi]$$", description: "反余弦函數定義。" },
      { id: 41, title: "反正切函數", category: "trigonometry", formula: "$$y=\\arctan x \\iff x=\\tan y,\\;y\\in\\left(-\\frac{\\pi}{2},\\frac{\\pi}{2}\\right]$$", description: "反正切函數定義。" },
      { id: 42, title: "正弦積化和差", category: "trigonometry", formula: "$$\\sin\\alpha\\sin\\beta=\\frac{1}{2}[\\cos(\\alpha-\\beta)-\\cos(\\alpha+\\beta)]$$", description: "正弦積化和差公式。" },
      
      /*【幾何 Geometry】(21)*/
      { id: 43, title: "切線定理", category: "geometry", formula: "$$PA\\cdot PB=PC\\cdot PD$$", description: "從點 P 引兩條切線到圓，其切線長度相等。" },
      { id: 44, title: "圓面積", category: "geometry", formula: "$$A=\\pi r^2$$", description: "半徑為 r 的圓面積公式。" },
      { id: 45, title: "圓周長", category: "geometry", formula: "$$C=2\\pi r$$", description: "半徑為 r 的圓周長公式。" },
      { id: 46, title: "海龍公式", category: "geometry", formula: "$$A=\\sqrt{s(s-a)(s-b)(s-c)}\\quad(s=\\frac{a+b+c}{2})$$", description: "任意三角形面積計算公式。" },
      { id: 47, title: "平行四邊形面積", category: "geometry", formula: "$$A=b\\cdot h$$", description: "底乘高計算平行四邊形面積。" },
      { id: 48, title: "梯形面積", category: "geometry", formula: "$$A=\\frac{(a+b)h}{2}$$", description: "梯形面積公式，其中 a、b 為上下底長。" },
      { id: 49, title: "正方形面積", category: "geometry", formula: "$$A=a^2$$", description: "正方形面積計算公式。" },
      { id: 50, title: "長方形面積", category: "geometry", formula: "$$A=l\\times w$$", description: "長方形面積計算公式。" },
      { id: 51, title: "三角形面積", category: "geometry", formula: "$$A=\\frac{1}{2}bh$$", description: "三角形面積的底乘高法。" },
      { id: 52, title: "橢圓面積", category: "geometry", formula: "$$A=\\pi ab$$", description: "橢圓面積公式，其中 a, b 為半軸長。" },
      { id: 53, title: "球體積", category: "geometry", formula: "$$V=\\frac{4}{3}\\pi r^3$$", description: "球體積公式。" },
      { id: 54, title: "球面積", category: "geometry", formula: "$$A=4\\pi r^2$$", description: "球面積公式。" },
      { id: 55, title: "圓錐體積", category: "geometry", formula: "$$V=\\frac{1}{3}\\pi r^2h$$", description: "圓錐體積計算公式。" },
      { id: 56, title: "圓錐側面積", category: "geometry", formula: "$$A=\\pi rl$$", description: "圓錐側面積，其中 l 為母線長。" },
      { id: 57, title: "棱柱體積", category: "geometry", formula: "$$V=B\\cdot h$$", description: "棱柱體積公式，B 為底面積。" },
      { id: 58, title: "棱柱側面積", category: "geometry", formula: "$$A=P\\cdot h$$", description: "棱柱側面積公式，P 為底面周長。" },
      { id: 59, title: "正多邊形面積", category: "geometry", formula: "$$A=\\frac{1}{2}ap$$", description: "正多邊形面積公式，a 為內接圓半徑（apothem），p 為周長。" },
      { id: 60, title: "圓環面積", category: "geometry", formula: "$$A=\\pi(R^2-r^2)$$", description: "兩同心圓之間的環形面積。" },
      { id: 61, title: "橢圓周長（近似）", category: "geometry", formula: "$$C\\approx\\pi[3(a+b)-\\sqrt{(3a+b)(a+3b)}]$$", description: "橢圓周長的近似公式。" },
      { id: 62, title: "弧長公式", category: "geometry", formula: "$$L=r\\theta$$", description: "圓心角為 \\(\\theta\\) 弧長計算公式（\\(\\theta\\) 以弧度計）。" },
      { id: 63, title: "圓弧面積", category: "geometry", formula: "$$A=\\frac{1}{2}r^2\\theta$$", description: "以弧度表示的圓弧所對應的扇形面積。" },
      /* 新增幾何公式（重複的球體表面積已刪除） */
      { id: 218, title: "平面幾何坐標系距離公式", category: "geometry", formula: "$$d = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}$$", description: "計算二維平面上兩點之間的距離。" },
      { id: 220, title: "橢圓面積擴展公式", category: "geometry", formula: "$$A = \\pi a b \\left(1 + \\frac{3h}{10 + \\sqrt{4 - 3h}}\\right) \\quad (h = \\frac{(a - b)^2}{(a + b)^2})$$", description: "橢圓面積的更高精度近似公式" },
      
      /*【微積分 Calculus】(21)*/
      { id: 64, title: "冪函數微分", category: "calculus", formula: "$$\\frac{d}{dx}x^n=nx^{n-1}$$", description: "冪函數求導公式。" },
      { id: 65, title: "冪函數積分", category: "calculus", formula: "$$\\int x^n dx=\\frac{x^{n+1}}{n+1}+C\\quad(n\\neq -1)$$", description: "冪函數的不定積分公式。" },
      { id: 66, title: "正弦微分", category: "calculus", formula: "$$\\frac{d}{dx}\\sin x=\\cos x$$", description: "正弦函數的導數。" },
      { id: 67, title: "余弦微分", category: "calculus", formula: "$$\\frac{d}{dx}\\cos x=-\\sin x$$", description: "余弦函數的導數。" },
      { id: 68, title: "指數微分", category: "calculus", formula: "$$\\frac{d}{dx}e^x=e^x$$", description: "自然指數函數的導數。" },
      { id: 69, title: "自然對數微分", category: "calculus", formula: "$$\\frac{d}{dx}\\ln x=\\frac{1}{x}$$", description: "自然對數的導數公式。" },
      { id: 70, title: "正弦積分", category: "calculus", formula: "$$\\int \\sin x dx=-\\cos x+C$$", description: "正弦函數的不定積分。" },
      { id: 71, title: "余弦積分", category: "calculus", formula: "$$\\int \\cos x dx=\\sin x+C$$", description: "余弦函數的不定積分。" },
      { id: 72, title: "指數積分", category: "calculus", formula: "$$\\int e^x dx=e^x+C$$", description: "自然指數函數的不定積分。" },
      { id: 73, title: "對數積分", category: "calculus", formula: "$$\\int \\frac{1}{x}dx=\\ln|x|+C$$", description: "1/x 的不定積分。" },
      { id: 74, title: "定積分基本定理", category: "calculus", formula: "$$\\int_a^b f(x)dx=F(b)-F(a)$$", description: "F 為 f 的一個原始函數。" },
      { id: 75, title: "鏈式法則", category: "calculus", formula: "$$\\frac{d}{dx}f(g(x))=f'(g(x))g'(x)$$", description: "複合函數求導法則。" },
      { id: 76, title: "乘積法則", category: "calculus", formula: "$$\\frac{d}{dx}[u(x)v(x)] = u'(x)v(x)+u(x)v'(x)$$", description: "兩函數乘積求導法則。" },
      { id: 77, title: "商法則", category: "calculus", formula: "$$\\frac{d}{dx}\\left(\\frac{u}{v}\\right)=\\frac{u'v-uv'}{v^2}$$", description: "商的導數公式。" },
      { id: 78, title: "指數函數微分（一般）", category: "calculus", formula: "$$\\frac{d}{dx}a^x=a^x\\ln a$$", description: "常數底指數函數的導數。" },
      { id: 79, title: "積分換元法", category: "calculus", formula: "$$\\int f(g(x))g'(x)dx=\\int f(u)du$$", description: "積分換元法公式。" },
      { id: 80, title: "分部積分法", category: "calculus", formula: "$$\\int u\\,dv=uv-\\int v\\,du$$", description: "分部積分公式。" },
      { id: 81, title: "洛必達法則", category: "calculus", formula: "$$\\lim_{x\\to a}\\frac{f(x)}{g(x)}=\\lim_{x\\to a}\\frac{f'(x)}{g'(x)}$$", description: "適用於 0/0 或 ∞/∞ 型極限。" },
      { id: 82, title: "泰勒級數展開", category: "calculus", formula: "$$f(x)=\\sum_{n=0}^\\infty \\frac{f^{(n)}(a)}{n!}(x-a)^n$$", description: "函數在 a 點的泰勒展開式。" },
      { id: 83, title: "傅立葉級數", category: "calculus", formula: "$$f(x)=a_0+\\sum_{n=1}^\\infty(a_n\\cos nx+b_n\\sin nx)$$", description: "函數的傅立葉展開表示。" },
      { id: 84, title: "微分中值定理", category: "calculus", formula: "$$\\exists\\,c\\in(a,b):f'(c)=\\frac{f(b)-f(a)}{b-a}$$", description: "中值定理的敘述。" },
      
      /*【概率統計 Statistics】(21)*/
      { id: 85, title: "算術平均數", category: "statistics", formula: "$$\\bar{x}=\\frac{1}{n}\\sum_{i=1}^n x_i$$", description: "樣本平均數。" },
      { id: 86, title: "標準差", category: "statistics", formula: "$$\\sigma=\\sqrt{\\frac{1}{n}\\sum_{i=1}^n (x_i-\\bar{x})^2}$$", description: "數據標準差的定義。" },
      { id: 87, title: "方差", category: "statistics", formula: "$$\\sigma^2=\\frac{1}{n}\\sum_{i=1}^n (x_i-\\bar{x})^2$$", description: "數據方差定義。" },
      { id: 88, title: "協方差", category: "statistics", formula: "$$\\text{Cov}(X,Y)=\\frac{1}{n}\\sum_{i=1}^n (x_i-\\bar{x})(y_i-\\bar{y})$$", description: "隨機變數間的協方差。" },
      { id: 89, title: "相關係數", category: "statistics", formula: "$$\\rho=\\frac{\\text{Cov}(X,Y)}{\\sigma_X\\sigma_Y}$$", description: "兩變數相關係數。" },
      { id: 90, title: "正態分布密度函數", category: "statistics", formula: "$$f(x)=\\frac{1}{\\sqrt{2\\pi}\\sigma}\\exp\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right)$$", description: "正態分布概率密度函數。" },
      { id: 91, title: "伯努利分布", category: "statistics", formula: "$$P(X=x)=p^x(1-p)^{1-x}\\quad(x=0,1)$$", description: "伯努利試驗的機率質量函數。" },
      { id: 92, title: "二項分布", category: "statistics", formula: "$$P(X=k)=\\binom{n}{k}p^k(1-p)^{n-k}$$", description: "二項分布公式。" },
      { id: 93, title: "泊松分布", category: "statistics", formula: "$$P(X=k)=\\frac{\\lambda^k e^{-\\lambda}}{k!}$$", description: "泊松分布概率質量函數。" },
      { id: 94, title: "指數分布", category: "statistics", formula: "$$f(x)=\\lambda e^{-\\lambda x}\\quad(x\\ge0)$$", description: "指數分布概率密度函數。" },
      { id: 95, title: "均勻分布", category: "statistics", formula: "$$f(x)=\\frac{1}{b-a}\\quad(a\\le x\\le b)$$", description: "連續均勻分布密度函數。" },
      { id: 96, title: "貝塔分布", category: "statistics", formula: "$$f(x)=\\frac{x^{\\alpha-1}(1-x)^{\\beta-1}}{B(\\alpha,\\beta)}$$", description: "貝塔分布密度函數（$0<x<1$）。" },
      { id: 97, title: "Gamma 分布", category: "statistics", formula: "$$f(x)=\\frac{1}{\\Gamma(k)\\theta^k}x^{k-1}e^{-x/\\theta}\\quad(x>0)$$", description: "Gamma 分布密度函數。" },
      { id: 98, title: "信賴區間", category: "statistics", formula: "$$\\bar{x}\\pm t_{\\alpha/2,n-1}\\frac{s}{\\sqrt{n}}$$", description: "小樣本信賴區間公式。" },
      { id: 99, title: "動差母函數", category: "statistics", formula: "$$M_X(t)=E(e^{tX})$$", description: "隨機變數的動差母函數。" },
      { id: 100, title: "分布函數", category: "statistics", formula: "$$F(x)=P(X\\le x)$$", description: "隨機變數的累積分布函數。" },
      { id: 101, title: "大數法則", category: "statistics", formula: "$$\\lim_{n\\to\\infty}\\bar{X}_n=\\mu$$", description: "樣本平均收斂於母體平均值（大數法則）。" },
      
      /*【線性代數 Linear Algebra】(21)*/
      { id: 102, title: "矩陣加法", category: "linear_algebra", formula: "$$ (A+B)_{ij}=a_{ij}+b_{ij} $$", description: "矩陣對應元素相加。" },
      { id: 103, title: "矩陣乘法", category: "linear_algebra", formula: "$$ (AB)_{ij}=\\sum_k a_{ik}b_{kj} $$", description: "矩陣乘法定義。" },
      { id: 104, title: "轉置矩陣", category: "linear_algebra", formula: "$$ (A^T)_{ij}=a_{ji} $$", description: "矩陣轉置定義。" },
      { id: 105, title: "2×2 行列式", category: "linear_algebra", formula: "$$ \\det\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}=ad-bc $$", description: "2×2 矩陣行列式公式。" },
      { id: 106, title: "3×3 行列式", category: "linear_algebra", formula: "$$ \\det(A)=a(ei-fh)-b(di-fg)+c(dh-eg) $$", description: "3×3 矩陣行列式展開法。" },
      { id: 107, title: "2×2 反矩陣", category: "linear_algebra", formula: "$$ A^{-1}=\\frac{1}{ad-bc}\\begin{pmatrix} d & -b \\\\ -c & a \\end{pmatrix} $$", description: "2×2 矩陣求逆公式。" },
      { id: 108, title: "克拉默法則", category: "linear_algebra", formula: "$$ x_i=\\frac{\\det(A_i)}{\\det(A)} $$", description: "用於求解線性方程組的克拉默法則。" },
      { id: 109, title: "特徵值定義", category: "linear_algebra", formula: "$$ Av=\\lambda v $$", description: "特徵值與特徵向量的定義。" },
      { id: 110, title: "特徵多項式", category: "linear_algebra", formula: "$$ \\det(A-\\lambda I)=0 $$", description: "求矩陣特徵值的多項式方程。" },
      { id: 111, title: "伴隨矩陣", category: "linear_algebra", formula: "$$ \\text{adj}(A) \\text{為 } A \\text{ 的伴隨矩陣} $$", description: "由餘子式構成的矩陣。" },
      { id: 112, title: "逆矩陣公式", category: "linear_algebra", formula: "$$ A^{-1}=\\frac{1}{\\det(A)}\\text{adj}(A) $$", description: "反矩陣與伴隨矩陣的關係。" },
      { id: 113, title: "向量內積", category: "linear_algebra", formula: "$$ \\langle u,v\\rangle=\\sum_{i} u_iv_i $$", description: "向量內積定義。" },
      { id: 114, title: "向量外積", category: "linear_algebra", formula: "$$ u\\times v \\text{ (3D 外積)} $$", description: "僅適用於三維向量的外積。" },
      { id: 115, title: "正交矩陣", category: "linear_algebra", formula: "$$ Q^TQ=I $$", description: "正交矩陣的定義。" },
      { id: 116, title: "LU 分解", category: "linear_algebra", formula: "$$ A=LU $$", description: "矩陣分解方法之一（L 為下三角矩陣，U 為上三角矩陣）。" },
      { id: 117, title: "QR 分解", category: "linear_algebra", formula: "$$ A=QR $$", description: "將矩陣分解為正交矩陣 Q 與上三角矩陣 R。" },
      { id: 118, title: "行空間與列空間", category: "linear_algebra", formula: "$$ \\text{Row}(A),\\;\\text{Col}(A) $$", description: "矩陣的行空間與列空間概念。" },
      { id: 119, title: "零空間", category: "linear_algebra", formula: "$$ \\{x\\mid Ax=0\\} $$", description: "矩陣 A 的解空間。" },
      { id: 120, title: "基底與維度", category: "linear_algebra", formula: "$$ \\text{dim}(V) \\text{為 } V \\text{ 的基底個數} $$", description: "向量空間維度定義。" },
      { id: 121, title: "奇異值分解", category: "linear_algebra", formula: "$$ A=U\\Sigma V^T $$", description: "矩陣的奇異值分解表示。" },
      
      /*【微分方程 Differential Equations】(21)*/
      { id: 122, title: "一階線性微分方程", category: "differential_equations", formula: "$$\\frac{dy}{dx}+P(x)y=Q(x)$$", description: "一階線性微分方程的標準形式。" },
      { id: 123, title: "一階線性通解", category: "differential_equations", formula: "$$y(x)=e^{-\\int P(x)dx}\\left(\\int Q(x)e^{\\int P(x)dx}dx+C\\right)$$", description: "求解一階線性微分方程的通解方法。" },
      { id: 124, title: "分離變數法", category: "differential_equations", formula: "$$\\frac{dy}{dx}=g(x)h(y)\\ \\Rightarrow\\ \\int \\frac{dy}{h(y)}=\\int g(x)dx$$", description: "分離變數求解微分方程。" },
      { id: 125, title: "齊次微分方程", category: "differential_equations", formula: "$$\\frac{dy}{dx}=F\\left(\\frac{y}{x}\\right)$$", description: "可透過變數代換求解的齊次方程。" },
      { id: 126, title: "二階齊次微分方程", category: "differential_equations", formula: "$$ay''+by'+cy=0$$", description: "二階常係數齊次微分方程。" },
      { id: 127, title: "特徵方程", category: "differential_equations", formula: "$$ar^2+br+c=0$$", description: "求解二階常係數微分方程的特徵方程。" },
      { id: 128, title: "二階非齊次微分方程", category: "differential_equations", formula: "$$ay''+by'+cy=f(x)$$", description: "二階非齊次微分方程求解方法之一。" },
      { id: 129, title: "常數變易法", category: "differential_equations", formula: "$$\\text{(方法描述)}$$", description: "解非齊次方程時常用的常數變易法。" },
      { id: 130, title: "歐拉微分方程", category: "differential_equations", formula: "$$x^2y''+axy'+by=0$$", description: "歐拉型微分方程，其解法需代換變數。" },
      { id: 131, title: "拉普拉斯轉換", category: "differential_equations", formula: "$$\\mathcal{L}\\{f(t)\\}=\\int_0^\\infty e^{-st}f(t)dt$$", description: "用於求解微分方程的拉普拉斯轉換定義。" },
      { id: 132, title: "拉普拉斯轉換性質", category: "differential_equations", formula: "$$\\mathcal{L}\\{f'(t)\\}=sF(s)-f(0)$$", description: "微分轉換性質。" },
      { id: 133, title: "初值問題", category: "differential_equations", formula: "$$y(0)=y_0$$", description: "微分方程初值條件。" },
      { id: 134, title: "自由振動方程", category: "differential_equations", formula: "$$y''+\\omega^2y=0$$", description: "無阻尼自由振動的微分方程。" },
      { id: 135, title: "阻尼振動方程", category: "differential_equations", formula: "$$y''+2\\zeta\\omega y'+\\omega^2y=0$$", description: "描述阻尼振動的二階微分方程。" },
      { id: 136, title: "存在唯一性定理", category: "differential_equations", formula: "$$\\text{(理論描述)}$$", description: "保證初值問題解存在且唯一的定理。" },
      { id: 137, title: "齊次系統通解", category: "differential_equations", formula: "$$y_h=\\text{(齊次方程通解)}$$", description: "齊次微分方程的通解表示。" },
      { id: 138, title: "變參數法", category: "differential_equations", formula: "$$\\text{(方法描述)}$$", description: "求解非齊次方程的變參數法。" },
      { id: 139, title: "邊值問題", category: "differential_equations", formula: "$$\\text{(描述性)}$$", description: "包含邊界條件的微分方程問題。" },
      
      /*【概率統計 Statistics】(21)*/
      { id: 140, title: "機率公理", category: "probability", formula: "$$0\\le P(A)\\le 1$$", description: "任何事件的機率介於 0 與 1 之間。" },
      { id: 141, title: "全事件機率", category: "probability", formula: "$$P(S)=1$$", description: "樣本空間 S 的機率為 1。" },
      { id: 142, title: "加法定理", category: "probability", formula: "$$P(A\\cup B)=P(A)+P(B)-P(A\\cap B)$$", description: "兩事件聯集的機率公式。" },
      { id: 143, title: "乘法定理", category: "probability", formula: "$$P(A\\cap B)=P(A)P(B|A)$$", description: "聯合機率的條件機率表達式。" },
      { id: 144, title: "條件機率", category: "probability", formula: "$$P(B|A)=\\frac{P(A\\cap B)}{P(A)}$$", description: "條件機率的定義。" },
      { id: 145, title: "獨立事件", category: "probability", formula: "$$P(A\\cap B)=P(A)P(B)$$", description: "獨立事件的乘法法則。" },
      { id: 146, title: "全概率定理", category: "probability", formula: "$$P(B)=\\sum_i P(B|A_i)P(A_i)$$", description: "將 B 的機率分解在互斥事件上。" },
      { id: 147, title: "貝氏定理", category: "probability", formula: "$$P(A|B)=\\frac{P(B|A)P(A)}{P(B)}$$", description: "反轉條件機率的公式。" },
      { id: 148, title: "期望值（離散）", category: "probability", formula: "$$E[X]=\\sum xP(x)$$", description: "離散隨機變數的期望值。" },
      { id: 149, title: "期望值（連續）", category: "probability", formula: "$$E[X]=\\int x f(x)dx$$", description: "連續隨機變數的期望值。" },
      { id: 150, title: "方差", category: "probability", formula: "$$\\text{Var}(X)=E[(X-E[X])^2]$$", description: "隨機變數的方差定義。" },
      { id: 151, title: "標準差", category: "probability", formula: "$$\\sigma=\\sqrt{\\text{Var}(X)}$$", description: "隨機變數標準差定義。" },
      { id: 152, title: "動差母函數", category: "probability", formula: "$$M_X(t)=E(e^{tX})$$", description: "隨機變數的動差母函數。" },
      { id: 153, title: "分布函數", category: "probability", formula: "$$F(x)=P(X\\le x)$$", description: "累積分布函數 (CDF) 定義。" },
      { id: 154, title: "全體離散機率質量函數", category: "probability", formula: "$$P(X=x)$$", description: "離散隨機變數機率質量函數 (PMF) 的表示。" },
      { id: 155, title: "連續機率密度函數", category: "probability", formula: "$$f(x)$$", description: "連續隨機變數的機率密度函數 (PDF) 表示。" },
      { id: 156, title: "大數法則", category: "probability", formula: "$$\\bar{X}_n\\to\\mu \\quad (n\\to\\infty)$$", description: "樣本平均數收斂於母體平均數。" },
      { id: 157, title: "中心極限定理", category: "probability", formula: "$$\\frac{\\bar{X}_n-\\mu}{\\sigma/\\sqrt{n}}\\to N(0,1)$$", description: "中心極限定理描述大樣本分布趨於常態分布。" },
      
      /*【數論 Number Theory】(21)*/
    { id: 158, title: "整數除法算法", category: "number_theory", formula: "$$a=bq+r,\\quad0\\le r小於b$$", description: "整數除法的標準表示法。" },

      { id: 159, title: "最大公因數", category: "number_theory", formula: "$$\\gcd(a,b)$$", description: "求兩數最大公因數的表示。" },
      { id: 160, title: "歐幾里得算法", category: "number_theory", formula: "$$\\gcd(a,b)=\\gcd(b,a\\bmod b)$$", description: "利用餘數求最大公因數的方法。" },
      { id: 161, title: "最小公倍數", category: "number_theory", formula: "$$\\text{lcm}(a,b)=\\frac{ab}{\\gcd(a,b)}$$", description: "兩數最小公倍數的公式。" },
      { id: 162, title: "質因數分解定理", category: "number_theory", formula: "$$n=p_1^{a_1}p_2^{a_2}\\cdots p_k^{a_k}$$", description: "每個正整數可唯一分解為質數乘積。" },
      { id: 163, title: "費馬小定理", category: "number_theory", formula: "$$a^{p-1}\\equiv 1\\pmod{p}$$", description: "對於質數 p 與非 p 倍數的 a 成立。" },
      { id: 164, title: "歐拉定理", category: "number_theory", formula: "$$a^{\\varphi(n)}\\equiv 1\\pmod{n}$$", description: "當 a 與 n 互質時成立的歐拉定理。" },
      { id: 165, title: "中國剩餘定理", category: "number_theory", formula: "$$\\text{(描述性)}$$", description: "多個同餘方程組的解存在唯一模乘積之解。" },
      { id: 166, title: "二次互反律", category: "number_theory", formula: "$$\\left(\\frac{p}{q}\\right)\\left(\\frac{q}{p}\\right)=(-1)^{\\frac{(p-1)(q-1)}{4}}$$", description: "描述兩個奇質數間的二次剩餘關係。" },
      { id: 167, title: "素數定理", category: "number_theory", formula: "$$\\pi(x)\\sim \\frac{x}{\\ln x}$$", description: "描述素數分布趨勢的定理。" },
      { id: 168, title: "莫比烏斯函數", category: "number_theory", formula: "$$\\mu(n)=\\begin{cases}1,& n=1;\\\\ (-1)^k,& n \\text{ 為 } k \\text{ 個不同質數的乘積};\\\\ 0,& \\text{其他} \\end{cases}$$", description: "莫比烏斯函數的定義。" },
      { id: 169, title: "和數函數", category: "number_theory", formula: "$$\\sigma(n)=\\sum_{d|n}d$$", description: "所有 n 的正因數之和。" },
      { id: 170, title: "友愛數定義", category: "number_theory", formula: "$$\\text{(描述性)}$$", description: "兩個數互為友愛數的定義（例如 220 與 284）。" },
      { id: 171, title: "完全數定義", category: "number_theory", formula: "$$\\sigma(n)=2n$$", description: "一個數若等於其所有正因數（不含自身）的和，則為完全數。" },
      { id: 172, title: "中國剩餘定理（例）", category: "number_theory", formula: "$$x\\equiv a_i\\pmod{m_i}\\, (i=1,2,\\dots,k)$$", description: "給定多個同餘條件求解唯一解（模 m 的乘積）。" },
      { id: 173, title: "歐拉函數", category: "number_theory", formula: "$$\\varphi(n)=n\\prod_{p|n}\\left(1-\\frac{1}{p}\\right)$$", description: "計算不大於 n 且與 n 互質的正整數個數。" },
      { id: 174, title: "中國剩餘定理（公式）", category: "number_theory", formula: "$$x=\\sum_{i=1}^k a_iM_i y_i\\quad\\text{其中 } M_i=\\frac{M}{m_i},\\; M=\\prod_{i=1}^k m_i$$", description: "中國剩餘定理解的構造公式。" },
      { id: 175, title: "素數判定法", category: "number_theory", formula: "$$\\text{(描述性)}$$", description: "利用各種素數測試方法（如試除法、Miller-Rabin等）。" },
      { id: 176, title: "模運算性質", category: "number_theory", formula: "$$a\\equiv b\\pmod{n}\\Rightarrow a+c\\equiv b+c$$", description: "模運算的基本性質。" },
      { id: 177, title: "模乘性質", category: "number_theory", formula: "$$a\\equiv b,\\; c\\equiv d \\pmod{n}\\Rightarrow ac\\equiv bd\\pmod{n}$$", description: "模乘運算性質。" },
      { id: 178, title: "二次同餘", category: "number_theory", formula: "$$x^2\\equiv a\\pmod{p}$$", description: "求解二次同餘方程的基本形式。" },
      
      /*【指數 Exponential】(21)*/
      { id: 179, title: "指數泰勒展開", category: "exponential", formula: "$$e^x=\\sum_{n=0}^\\infty \\frac{x^n}{n!}$$", description: "自然指數函數的泰勒級數展開式。" },
      { id: 180, title: "連續複利公式", category: "exponential", formula: "$$A=Pe^{rt}$$", description: "連續複利計算公式。" },
      { id: 181, title: "指數增長模型", category: "exponential", formula: "$$N(t)=N_0e^{kt}$$", description: "描述指數增長或衰退的模型。" },
      { id: 182, title: "指數微分", category: "exponential", formula: "$$\\frac{d}{dx}e^{ax}=ae^{ax}$$", description: "一般形式的指數函數求導。" },
      { id: 183, title: "指數積分", category: "exponential", formula: "$$\\int e^{ax}dx=\\frac{1}{a}e^{ax}+C$$", description: "指數函數的不定積分公式。" },
      { id: 184, title: "指數方程解", category: "exponential", formula: "$$a^x=b\\iff x=\\frac{\\ln b}{\\ln a}$$", description: "指數方程的求解公式。" },
      { id: 185, title: "自然指數反函數", category: "exponential", formula: "$$\\ln(e^x)=x$$", description: "自然對數與指數互為反函數。" },
      { id: 186, title: "雙曲正弦", category: "exponential", formula: "$$\\sinh x=\\frac{e^x-e^{-x}}{2}$$", description: "雙曲正弦函數的定義。" },
      { id: 187, title: "雙曲余弦", category: "exponential", formula: "$$\\cosh x=\\frac{e^x+e^{-x}}{2}$$", description: "雙曲余弦函數的定義。" },
      { id: 188, title: "雙曲正切", category: "exponential", formula: "$$\\tanh x=\\frac{\\sinh x}{\\cosh x}$$", description: "雙曲正切函數的定義。" },
      { id: 189, title: "雙曲正弦微分", category: "exponential", formula: "$$\\frac{d}{dx}\\sinh x=\\cosh x$$", description: "雙曲正弦函數的導數。" },
      { id: 190, title: "雙曲余弦微分", category: "exponential", formula: "$$\\frac{d}{dx}\\cosh x=\\sinh x$$", description: "雙曲余弦函數的導數。" },
      { id: 191, title: "正弦與對數關係", category: "exponential", formula: "$$a^x=e^{x\\ln a}$$", description: "將一般指數函數轉換成自然指數形式。" },
      { id: 192, title: "歐拉公式", category: "exponential", formula: "$$e^{i\\theta}=\\cos\\theta+i\\sin\\theta$$", description: "複指數函數的基本公式。" },
      { id: 193, title: "指數模", category: "exponential", formula: "$$|e^{i\\theta}|=1$$", description: "複指數函數的模長為 1。" },
      { id: 194, title: "極限定義", category: "exponential", formula: "$$\\lim_{x\\to 0}(1+x)^{1/x}=e$$", description: "e 的基本極限定義。" },
      { id: 195, title: "微分方程應用", category: "exponential", formula: "$$\\frac{dy}{dx}=ky\\ \\Rightarrow\\ y=Ce^{kx}$$", description: "描述指數型增長的微分方程解。" },
      { id: 196, title: "指數型迴歸", category: "exponential", formula: "$$y=ae^{bx}$$", description: "常用於數據擬合的指數迴歸模型。" },
      { id: 197, title: "指數對稱性", category: "exponential", formula: "$$e^{-x}=\\frac{1}{e^x}$$", description: "指數函數的基本對稱性。" },
      
      /*【對數 Logarithm】(21)*/
      { id: 198, title: "對數加法性質", category: "logarithm", formula: "$$\\log_a(xy)=\\log_a x+\\log_a y$$", description: "對數的乘積轉換為和。" },
      { id: 199, title: "自然對數", category: "logarithm", formula: "$$\\ln(e^x)=x$$", description: "自然對數與指數互為反函數。" },
      { id: 200, title: "換底公式", category: "logarithm", formula: "$$\\log_b a=\\frac{\\ln a}{\\ln b}$$", description: "將對數從一個底數轉換到另一個底數。" },
      { id: 201, title: "對數減法性質", category: "logarithm", formula: "$$\\log_a\\frac{x}{y}=\\log_a x-\\log_a y$$", description: "對數的商轉換為差。" },
      { id: 202, title: "對數冪性質", category: "logarithm", formula: "$$\\log_a(x^r)=r\\log_a x$$", description: "指數移至對數前的乘數。" },
      { id: 203, title: "指數與對數反函數", category: "logarithm", formula: "$$a^{\\log_a x}=x$$", description: "指數與對數互為反函數。" },
      { id: 204, title: "自然對數定義", category: "logarithm", formula: "$$\\ln x=\\int_1^x \\frac{1}{t}dt$$", description: "自然對數的積分定義。" },
      { id: 205, title: "對數函數微分", category: "logarithm", formula: "$$\\frac{d}{dx}\\ln x=\\frac{1}{x}$$", description: "自然對數的求導公式。" },
      { id: 206, title: "對數函數積分", category: "logarithm", formula: "$$\\int \\ln x\\,dx=x\\ln x-x+C$$", description: "對數函數的不定積分。" },
      { id: 207, title: "反對數公式", category: "logarithm", formula: "$$e^{\\ln x}=x$$", description: "自然對數與指數互為反函數（重複）。" },
      { id: 208, title: "常用對數", category: "logarithm", formula: "$$\\log_{10}x$$", description: "以 10 為底的對數表示法。" },
      { id: 209, title: "對數不等式", category: "logarithm", formula: "$$\\text{若 } a>1, \\; \\log_a x<\\log_a y \\iff x<y$$", description: "對數函數的單調性說明。" },
      { id: 210, title: "對數極限", category: "logarithm", formula: "$$\\lim_{x\\to 0^+}\\ln x=-\\infty,\\quad \\lim_{x\\to \\infty}\\ln x=\\infty$$", description: "對數函數在邊界的極限值。" },
      { id: 211, title: "對數方程求解", category: "logarithm", formula: "$$\\ln x=c \\iff x=e^c$$", description: "對數方程的解法。" },
      { id: 212, title: "對數級數展開", category: "logarithm", formula: "$$\\ln(1+x)=\\sum_{n=1}^\\infty (-1)^{n+1}\\frac{x^n}{n},\\;|x|<1$$", description: "自然對數的泰勒級數展開。" },
      { id: 213, title: "對數換底求導", category: "logarithm", formula: "$$\\frac{d}{dx}\\log_a x=\\frac{1}{x\\ln a}$$", description: "一般對數求導公式。" }
    ];
    
    // ------------------ 主要程式碼 ------------------
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('search-input');
      const searchBtn = document.getElementById('search-btn');
      const formulaContainer = document.getElementById('formula-container');
      const categoryBtns = document.querySelectorAll('.category-btn');
      const apiKeyModal = document.getElementById('api-key-modal');
      const chatModal = document.getElementById('chat-modal');
      const closeBtn = document.querySelector('.close-btn');
      const sendMessageBtn = document.getElementById('send-message');
      const chatInput = document.getElementById('chat-input');
      const chatMessages = document.getElementById('chat-messages');
      const saveApiKeyBtn = document.getElementById('save-api-key');
      const apiKeyInput = document.getElementById('api-key-input');
      const downloadHistoryBtn = document.getElementById('download-history-btn');
      
      let apiKey = localStorage.getItem('groq_api_key') || DEFAULT_API_KEY;
      let currentFormula = null;
      let conversationHistory = [];
      
      if (apiKey === DEFAULT_API_KEY && !localStorage.getItem('groq_api_key')) {
        localStorage.setItem('groq_api_key', DEFAULT_API_KEY);
      }
      
      apiKeyModal.style.display = 'none';
      if (!apiKey) {
        apiKeyModal.style.display = 'block';
      }
      
      // 初始化 Fuse.js 模糊搜尋
      const fuseOptions = {
        keys: [
          {name: 'title', weight: 0.6},
          {name: 'description', weight: 0.4}
        ],
        includeScore: true,
        threshold: 0.3,
        minMatchCharLength: 2
      };
      const fuse = new Fuse(formulas, fuseOptions);
      
      function displayFormulas(filteredFormulas = formulas) {
        formulaContainer.innerHTML = '';
        if (filteredFormulas.length === 0) {
          formulaContainer.innerHTML = '<p>沒有找到符合的公式</p>';
          return;
        }
        filteredFormulas.forEach(formula => {
          const formulaCard = document.createElement('div');
          formulaCard.className = 'formula-card';
          formulaCard.innerHTML = `
            <h3>${formula.title}</h3>
            <div class="formula-display">${formula.formula}</div>
            <p>${formula.description || ''}</p>
            <button class="learn-btn" data-id="${formula.id}">互動學習</button>
          `;
          formulaContainer.appendChild(formulaCard);
          MathJax.typeset();
        });
        document.querySelectorAll('.learn-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const formulaId = parseInt(e.target.getAttribute('data-id'));
            currentFormula = formulas.find(f => f.id === formulaId);
            if (!apiKey) {
              apiKeyModal.style.display = 'block';
            } else {
              openChatModal(currentFormula);
            }
          });
        });
      }
      
      function displayFormulasByCategory(category) {
        let filteredFormulas = formulas;
        if (category !== 'all') {
          filteredFormulas = formulas.filter(formula => formula.category === category);
        }
        displayFormulas(filteredFormulas);
      }
      
      function searchFormulas(keyword) {
        let results;
        if(keyword.length > 0) {
          results = fuse.search(keyword).map(result => result.item);
        } else {
          results = formulas;
        }
        
        const sortedResults = results.sort((a, b) => 
          a.title.toLowerCase().indexOf(keyword.toLowerCase()) - 
          b.title.toLowerCase().indexOf(keyword.toLowerCase())
        );
        
        displayFormulas(sortedResults);
      }
      
      function openChatModal(formula) {
        chatModal.style.display = 'block';
        document.getElementById('chat-title').innerText = `互動學習: ${formula.title}`;
        chatMessages.innerHTML = '';
        conversationHistory = [];
        addMessage('ai', `讓我們來學習 "${formula.title}"。這是公式： ${formula.formula}  \n\n${formula.description || ''}\n\n準備好了嗎？請回答我的多選題！`);
        sendToAI(`你是一個數學教育助手。請根據 "${formula.title}" 與公式 ${formula.formula}，以四選一方式出題，並標明選項 ABCD。題目難度適中，請提供第一題。`);
      }
      
      function addMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = sender === 'user' ? 'user-message' : 'ai-message';
        messageDiv.innerHTML = text;
        chatMessages.appendChild(messageDiv);
        MathJax.typeset();
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      async function sendToAI(message) {
        try {
          if (!apiKey) {
            addMessage('ai', '請先設置您的 Groq API 金鑰');
            apiKeyModal.style.display = 'block';
            return;
          }
          const loadingMessage = document.createElement('div');
          loadingMessage.className = 'ai-message loading';
          loadingMessage.innerText = '思考中...';
          chatMessages.appendChild(loadingMessage);
          conversationHistory.push({ role: "user", content: message });
          if (conversationHistory.length > 10) {
            conversationHistory = conversationHistory.slice(-10);
          }
          const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: "llama-3.2-90b-vision-preview",
              messages: [
                { role: "system", content: "你是一個專業的數學教育助手，請以四選一測驗方式回覆，並使用繁體中文與 MathJax 語法表達數學公式。" },
                ...conversationHistory
              ],
              temperature: 0.7
            })
          });
          if (!response.ok) {
            throw new Error(`API請求失敗: ${response.status}`);
          }
          const data = await response.json();
          const aiMessage = data.choices[0].message.content;
          chatMessages.removeChild(loadingMessage);
          addMessage('ai', aiMessage);
          conversationHistory.push({ role: "assistant", content: aiMessage });
        } catch (error) {
          console.error('發送訊息時出錯:', error);
          chatMessages.querySelector('.loading')?.remove();
          addMessage('ai', `發生錯誤: ${error.message}。請檢查您的 API 金鑰或網路連接。`);
        }
      }
      
      // 新增：下載學習歷程功能
      downloadHistoryBtn.addEventListener("click", () => {
        if(conversationHistory.length === 0) {
          alert("目前沒有學習歷程可下載。");
          return;
        }
        const content = conversationHistory.map(item => {
          return (item.role === "user" ? "使用者: " : "系統: ") + item.content;
        }).join("\n\n");
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "學習歷程.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
      
      categoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          categoryBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const category = btn.getAttribute('data-category');
          displayFormulasByCategory(category);
        });
      });
      searchBtn.addEventListener('click', () => {
        searchFormulas(searchInput.value);
      });
      searchInput.addEventListener('input', () => { 
        searchFormulas(searchInput.value);
      });
      saveApiKeyBtn.addEventListener('click', () => {
        apiKey = apiKeyInput.value.trim();
        if (apiKey) {
          localStorage.setItem('groq_api_key', apiKey);
          apiKeyModal.style.display = 'none';
          if (currentFormula) {
            openChatModal(currentFormula);
          }
        } else {
          alert('請輸入有效的 API 金鑰');
        }
      });
      closeBtn.addEventListener('click', () => {
        chatModal.style.display = 'none';
      });
      sendMessageBtn.addEventListener('click', () => {
        const message = chatInput.value.trim();
        if (message) {
          addMessage('user', message);
          sendToAI(message);
          chatInput.value = '';
        }
      });
      chatInput.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') {
          sendMessageBtn.click();
        }
      });
      window.addEventListener('click', (e) => {
        if (e.target === apiKeyModal) {
          apiKeyModal.style.display = 'none';
        }
        if (e.target === chatModal) {
          chatModal.style.display = 'none';
        }
      });
      displayFormulas();
      document.querySelector('[data-category="all"]').classList.add('active');
    });
  </script>
</body>
  <div style="text-align: center;">@Snake's AI 2025</div>

</html>
